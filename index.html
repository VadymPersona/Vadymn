<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Major Wallet</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            background-color: #000; color: white; 
            font-family: -apple-system, sans-serif;
            overflow-x: hidden; padding-bottom: 110px;
        }
        .card-grad { 
            background: linear-gradient(145deg, #1a1a1a 0%, #050505 100%); 
            border: 1px solid rgba(255,255,255,0.08); 
        }
        .nav-blur {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        .stars-badge {
            background: rgba(255, 191, 0, 0.1);
            border: 1px solid rgba(255, 191, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        #deposit-modal {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
        }
        .modal-hidden { transform: translateY(100%); opacity: 0; pointer-events: none; }
        .modal-show { transform: translateY(0); opacity: 1; pointer-events: auto; }
        
        .ton-btn { background: linear-gradient(90deg, #007aff, #005bb5); }
        .stars-btn { background: linear-gradient(90deg, #ffbf00, #ff8c00); color: black; }
        
        .rate-badge {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
        }
    </style>
</head>
<body class="p-6">

    <div class="flex justify-between items-start mb-8 pt-2">
        <div class="flex items-center gap-3">
            <div class="relative">
                <img id="user-avatar" src="" class="w-12 h-12 rounded-full border border-zinc-800 object-cover opacity-0 transition-opacity">
                <div id="avatar-loader" class="absolute inset-0 w-12 h-12 rounded-full bg-zinc-900 animate-pulse"></div>
            </div>
            <div>
                <h1 id="user-name" class="text-sm font-bold tracking-tight text-white">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
                <p class="text-[10px] text-zinc-500 uppercase tracking-tighter">Verified User</p>
            </div>
        </div>
        <div class="stars-badge px-4 py-2 rounded-full flex items-center gap-2">
            <span class="text-sm font-black italic" id="stars-balance">0</span>
            <span class="text-xs">‚≠ê</span>
        </div>
    </div>

    <div class="flex flex-col items-center mb-10">
        <p class="text-zinc-500 text-[10px] uppercase tracking-[0.2em] font-bold mb-1">Total Balance</p>
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2">
                <span class="text-4xl font-black italic tracking-tighter" id="display-balance">0.00</span>
                <span class="text-2xl font-bold text-blue-500">TON</span>
            </div>
            <button onclick="toggleModal(true)" class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center active:scale-90 transition-transform">
                <span class="text-3xl font-bold text-white">+</span>
            </button>
        </div>
    </div>

    <div class="card-grad w-full h-40 rounded-[30px] p-6 flex flex-col justify-between relative overflow-hidden mb-8">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-[9px] uppercase tracking-widest text-zinc-500 font-bold mb-1">Network Identity</p>
                <p class="text-sm font-bold text-zinc-300">@mj_cryptogame_bot</p>
            </div>
            <img src="https://ton.org/download/ton_symbol.svg" class="w-6 h-6 opacity-30" alt="TON">
        </div>
        <div class="flex justify-between items-end">
            <span id="user-id-display" class="text-[10px] font-mono text-zinc-600">ID: 0000000000</span>
            <div class="opacity-10 text-[10px] font-black italic tracking-widest uppercase text-white">Major Ecosystem</div>
        </div>
    </div>

    <div class="flex flex-col gap-3 mb-10">
        <p class="text-zinc-500 text-[9px] uppercase tracking-widest font-bold px-2">Live Market</p>
        
        <div class="rate-badge p-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center">
                    <img src="https://ton.org/download/ton_symbol.svg" class="w-4 h-4" alt="TON">
                </div>
                <span class="font-bold text-xs">TON / USD</span>
            </div>
            <span id="ton-price" class="font-mono font-bold text-zinc-300">$0.00</span>
        </div>

        <div class="rate-badge p-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center overflow-hidden">
                    <img src="mj.png" class="w-full h-full object-cover" alt="MJ" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2584/2584651.png'">
                </div>
                <span class="font-bold text-xs">MJ / TON</span>
            </div>
            <span class="font-mono font-bold text-blue-500">0.0002 TON</span>
        </div>
    </div>

    <div id="deposit-modal" class="fixed inset-0 z-[100] flex items-end modal-hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleModal(false)"></div>
        <div class="relative w-full bg-zinc-950 rounded-t-[40px] p-8 border-t border-white/10 shadow-2xl">
            <div class="w-12 h-1 bg-zinc-800 rounded-full mx-auto mb-8"></div>
            <h2 class="text-xl font-bold mb-6 text-center text-white">–ú–µ—Ç–æ–¥ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
            <div class="flex flex-col gap-3">
                <button onclick="processTransaction()" class="ton-btn w-full py-5 rounded-2xl font-black text-xs uppercase tracking-widest active:scale-95 text-white">–ü–æ–ø–æ–ª–Ω–∏—Ç—å TON</button>
                <button onclick="payWithStars()" class="stars-btn w-full py-5 rounded-2xl font-black text-xs uppercase tracking-widest active:scale-95">–ö—É–ø–∏—Ç—å Stars ‚≠ê</button>
            </div>
        </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 h-20 nav-blur flex justify-around items-center px-8 z-50">
        <div class="flex flex-col items-center gap-1 text-blue-500">
            <span class="text-2xl">üè†</span>
            <span class="text-[10px] font-bold uppercase tracking-widest">–ì–ª–∞–≤–Ω–∞—è</span>
        </div>
        <a href="cases.html" class="flex flex-col items-center gap-1 opacity-40">
            <span class="text-2xl">üì¶</span>
            <span class="text-[10px] font-medium uppercase tracking-widest text-zinc-400">–ö–µ–π—Å—ã</span>
        </a>
        <a href="profile.html" class="flex flex-col items-center gap-1 opacity-40">
            <span class="text-2xl">üë§</span>
            <span class="text-[10px] font-medium uppercase tracking-widest text-zinc-400">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        
        // 1. –°–æ–æ–±—â–∞–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –µ–≥–æ
        tg.ready();
        tg.expand();

        const SERVER_URL = "https://vadympersona.github.io/Vadymn/"; 
        const MY_ADDRESS = "UQBAshgLU8AMuBwOQjzbpE127NjtI8g9PfoVtGtVCy9SS_kg";

        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://vadympersona.github.io/Vadymn/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-trigger'
        });

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function initUserData() {
            const user = tg.initDataUnsafe?.user;
            const nameEl = document.getElementById('user-name');
            const idEl = document.getElementById('user-id-display');
            const avatar = document.getElementById('user-avatar');
            const loader = document.getElementById('avatar-loader');

            if (user) {
                nameEl.innerText = user.first_name || "Major User";
                idEl.innerText = `ID: ${user.id}`;
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –∞–≤–∞—Ç–∞—Ä–∞
                const photoUrl = user.photo_url || `https://ui-avatars.com/api/?name=${user.first_name}&background=007AFF&color=fff`;
                avatar.src = photoUrl;
                avatar.onload = () => {
                    avatar.classList.remove('opacity-0');
                    if (loader) loader.style.display = 'none';
                };
            } else {
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç (—Ç–µ—Å—Ç –≤–Ω–µ –¢–ì)
                nameEl.innerText = "Guest Mode";
                idEl.innerText = "ID: 00000000";
                if (loader) loader.style.display = 'none';
                avatar.classList.remove('opacity-0');
                avatar.src = "https://ui-avatars.com/api/?name=Guest";
            }
        }

        async function getTonPrice() {
            try {
                const response = await fetch('https://api.coinbase.com/v2/prices/TON-USD/spot');
                const data = await response.json();
                document.getElementById('ton-price').innerText = `$${parseFloat(data.data.amount).toFixed(2)}`;
            } catch (e) { 
                document.getElementById('ton-price').innerText = "$5.40"; 
            }
        }

        async function syncBalance() {
            const user = tg.initDataUnsafe?.user;
            if (!user) return;
            try {
                const response = await fetch(`${SERVER_URL}/get_balance/${user.id}`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('display-balance').innerText = data.ton_balance.toFixed(2);
                    document.getElementById('stars-balance').innerText = data.stars_balance || 0;
                }
            } catch (e) { console.log("Balance sync error"); }
        }

        function toggleModal(show) {
            const m = document.getElementById('deposit-modal');
            if (show) m.classList.replace('modal-hidden', 'modal-show');
            else m.classList.replace('modal-show', 'modal-hidden');
            tg.HapticFeedback.impactOccurred('medium');
        }

        async function payWithStars() {
            toggleModal(false);
            tg.showAlert("–ò–Ω–≤–æ–π—Å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è... –ù–µ–æ–±—Ö–æ–¥–∏–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–π API.");
        }

        async function processTransaction() {
            if (!tonConnectUI.connected) { 
                await tonConnectUI.openModal(); 
                return; 
            }
            const tx = {
                validUntil: Math.floor(Date.now() / 1000) + 600,
                messages: [{ 
                    address: MY_ADDRESS, 
                    amount: "100000000", 
                    payload: btoa(tg.initDataUnsafe?.user?.id.toString() || "0") 
                }]
            };
            try { 
                toggleModal(false); 
                await tonConnectUI.sendTransaction(tx); 
            } catch (e) { console.error(e); }
        }

        // –ó–∞–ø—É—Å–∫
        initUserData();
        getTonPrice();
        syncBalance();
    </script>
</body>
</html>