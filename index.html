<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Major App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --tg-theme-bg: #000; --tg-theme-accent: #248bf2; }
        body { background-color: black; color: white; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        /* Skeleton Animation */
        .skeleton { position: relative; overflow: hidden; background: #1a1a1a; border-radius: 12px; }
        .skeleton::after {
            content: ""; position: absolute; top: 0; right: 0; bottom: 0; left: 0;
            transform: translateX(-100%);
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer { 100% { transform: translateX(100%); } }

        .card-grad { background: linear-gradient(145deg, #1a1a1a 0%, #0a0a0a 100%); border: 1px solid rgba(255,255,255,0.1); }
        .tab-active { color: var(--tg-theme-accent); border-bottom: 2px solid var(--tg-theme-accent); }
    </style>
</head>
<body class="p-4">

    <div class="flex items-center gap-3 mb-8">
        <img id="u-photo" src="https://t.me/i/userpic/320/personovich.jpg" class="w-12 h-12 rounded-full border border-zinc-800">
        <div>
            <h1 id="u-name" class="font-bold text-lg">Loading...</h1>
            <p class="text-xs text-zinc-500">Verified Wallet</p>
        </div>
    </div>

    <div id="balance-card" class="skeleton h-44 w-full mb-8">
        </div>

    <div class="mb-4 flex justify-between items-end">
        <h2 class="font-bold text-xl">History</h2>
        <span class="text-xs text-zinc-500">Recent Wins</span>
    </div>

    <div id="history-list" class="space-y-3">
        <div class="skeleton h-16 w-full"></div>
        <div class="skeleton h-16 w-full"></div>
        <div class="skeleton h-16 w-full"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.headerColor = '#000000';

        const user = tg.initDataUnsafe?.user || { id: 7487680515, first_name: "Major User" };
        document.getElementById('u-name').innerText = user.first_name;

        async function fetchData() {
            try {
                // Замени на URL своего Ngrok
                const res = await fetch(`/api/data?user_id=${user.id}`);
                const data = await res.json();

                renderApp(data);
            } catch (e) {
                console.error(e);
            }
        }

        function renderApp(data) {
            // Отрисовка карты баланса
            const balanceCard = document.getElementById('balance-card');
            balanceCard.classList.remove('skeleton');
            balanceCard.innerHTML = `
                <div class="card-grad h-full w-full rounded-[28px] p-6 flex flex-col justify-between">
                    <div>
                        <p class="text-[10px] uppercase tracking-widest text-zinc-500 font-bold">Total Balance</p>
                        <div class="flex items-baseline gap-2 mt-1">
                            <span class="text-5xl font-black">${data.balance.toFixed(2)}</span>
                            <span class="text-blue-500 font-bold">MJ</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="text-[10px] text-zinc-600 font-mono">**** **** **** ${user.id.toString().slice(-4)}</div>
                        <div class="bg-blue-600/10 text-blue-500 text-[10px] px-3 py-1 rounded-full font-bold">ACTIVE</div>
                    </div>
                </div>
            `;

            // Отрисовка истории
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';

            if (data.history.length === 0) {
                historyList.innerHTML = '<p class="text-center text-zinc-600 py-10">No wins yet...</p>';
                return;
            }

            data.history.forEach(tx => {
                const item = document.createElement('div');
                item.className = 'card-grad rounded-2xl p-4 flex justify-between items-center animate-in fade-in slide-in-from-bottom-2 duration-500';
                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-green-500/10 rounded-full flex items-center justify-center text-green-500 font-bold">MJ</div>
                        <div>
                            <p class="text-sm font-bold">Win in round #${tx.round}</p>
                            <p class="text-[10px] text-zinc-500">${new Date(tx.date * 1000).toLocaleString()}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-green-400 font-bold">+${tx.amount}</p>
                        <p class="text-[9px] text-zinc-600 uppercase">Confirmed</p>
                    </div>
                `;
                historyList.appendChild(item);
            });
        }

        setTimeout(fetchData, 1500); // Имитация красивой задержки для скелетона
    </script>
</body>
</html>