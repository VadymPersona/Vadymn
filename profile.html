<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Major Profile</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #000; color: white; font-family: -apple-system, sans-serif; padding-bottom: 120px; }
        .card-grad { 
            background: linear-gradient(145deg, #1a1a1a 0%, #050505 100%); 
            border: 1px solid rgba(255,255,255,0.08); 
            border-radius: 30px;
        }
        .nav-blur {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        #ton-connect-button button { background-color: #248bf2 !important; border-radius: 12px !important; width: 100% !important; }
        
        .input-ton {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            outline: none;
            transition: all 0.3s;
        }

        /* –ê–ù–ò–ú–ê–¶–ò–Ø –ö–ù–û–ü–ö–ò –°–û–ó–î–ê–¢–¨ –ö–û–ù–ö–£–†–° */
        @keyframes shine {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .btn-create {
            background: linear-gradient(270deg, #248bf2, #0052cc, #60a5fa);
            background-size: 400% 400%;
            animation: shine 4s ease infinite;
            box-shadow: 0 0 20px rgba(36, 139, 242, 0.3);
            transition: transform 0.2s;
        }
        .btn-create:active { transform: scale(0.96); }

        .btn-preset {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
        }
        .btn-preset:active { scale: 0.9; background: #248bf2; border-color: #248bf2; }

        .btn-send {
            background: linear-gradient(90deg, #248bf2, #0052cc);
            box-shadow: 0 4px 15px rgba(36, 139, 242, 0.3);
        }
    </style>
</head>
<body class="p-6">

    <div class="flex flex-col items-center mt-4 mb-6">
        <div class="relative mb-3">
            <img id="user-avatar" src="" class="w-20 h-20 rounded-full border-2 border-zinc-800 object-cover opacity-0 transition-opacity duration-500">
            <div id="loader" class="absolute inset-0 bg-zinc-900 rounded-full animate-pulse"></div>
        </div>
        <h1 id="user-name" class="text-xl font-bold">...</h1>
        <p id="user-username" class="text-zinc-500 text-xs">@username</p>
    </div>

    <a href="roulet.html" class="block mb-4">
        <button class="btn-create w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest text-white">
            –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å üèÜ
        </button>
    </a>

    <div class="card-grad p-5 mb-4">
        <p class="text-[10px] uppercase tracking-widest text-zinc-500 font-bold mb-3 italic">–¢–≤–æ—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</p>
        <div class="flex items-center gap-2 bg-black/40 p-3 rounded-xl border border-white/5 mb-3">
            <span id="ref-link-text" class="text-[11px] text-zinc-300 truncate flex-1">t.me/mj_cryptogame_bot?start=...</span>
            <button onclick="copyRef()" class="text-blue-500 font-bold text-[11px] uppercase">Copy</button>
        </div>
        <button onclick="shareRef()" class="w-full py-3 bg-white/5 border border-white/10 rounded-xl text-[11px] font-bold uppercase tracking-wider active:bg-white/10 transition-all">
            –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞
        </button>
    </div>

    <div class="card-grad p-6 mb-4">
        <div class="mb-6">
            <p class="text-[10px] uppercase tracking-widest text-zinc-500 font-bold mb-3 italic">1. Connect Wallet</p>
            <div id="ton-connect-button"></div>
        </div>

        <div id="donation-block" class="opacity-30 pointer-events-none transition-all duration-500">
            <p class="text-[10px] uppercase tracking-widest text-zinc-400 font-bold mb-3 italic">2. Support Amount (min 0.1)</p>
            
            <div class="relative mb-4">
                <input type="number" id="ton-amount" value="0.1" step="0.1" min="0.1"
                       class="input-ton w-full py-4 px-5 rounded-2xl text-xl font-bold tracking-tight text-white">
                <span class="absolute right-5 top-1/2 -translate-y-1/2 text-blue-500 font-bold">TON</span>
            </div>

            <div class="grid grid-cols-3 gap-2 mb-6">
                <button onclick="setAmount(0.1)" class="btn-preset py-2 rounded-xl text-xs font-bold text-white">0.1</button>
                <button onclick="setAmount(0.5)" class="btn-preset py-2 rounded-xl text-xs font-bold text-white">0.5</button>
                <button onclick="setAmount(1.0)" class="btn-preset py-2 rounded-xl text-xs font-bold text-white">1.0</button>
            </div>

            <button onclick="sendDonation()" class="btn-send w-full py-4 rounded-2xl font-bold text-sm text-white">
                Send Donation
            </button>
        </div>
    </div>

    <div id="status-msg" class="text-center text-[10px] font-bold uppercase tracking-widest py-2"></div>

    <div class="fixed bottom-0 left-0 right-0 h-20 nav-blur flex justify-around items-center px-8 z-50">
        <a href="index.html" class="flex flex-col items-center gap-1 opacity-40 hover:opacity-100 transition-opacity">
            <span class="text-2xl">üè†</span>
            <span class="text-[10px] font-medium uppercase tracking-widest text-zinc-400">–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        <a href="cases.html" class="flex flex-col items-center gap-1 opacity-40 hover:opacity-100 transition-opacity">
            <span class="text-2xl">üì¶</span>
            <span class="text-[10px] font-medium uppercase tracking-widest text-zinc-400">–ö–µ–π—Å—ã</span>
        </a>
        <div class="flex flex-col items-center gap-1 text-blue-500">
            <span class="text-2xl">üë§</span>
            <span class="text-[10px] font-bold uppercase tracking-widest">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const MY_WALLET_ADDRESS = "UQBAshgLU8AMuBwOQjzbpE127NjtI8g9PfoVtGtVCy9SS_kg";
        const BOT_LINK = "https://t.me/mj_cryptogame_bot";

        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://vadympersona.github.io/Vadymn/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-button'
        });

        const user = tg.initDataUnsafe?.user;
        if (user) {
            document.getElementById('user-name').innerText = user.first_name;
            document.getElementById('user-username').innerText = user.username ? `@${user.username}` : '';
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Ñ–∫—É
            const fullRefLink = `${BOT_LINK}?start=${user.id}`;
            document.getElementById('ref-link-text').innerText = fullRefLink;

            const avatar = document.getElementById('user-avatar');
            avatar.src = user.photo_url || `https://t.me/i/userpic/320/${user.username || 'default'}.jpg`;
            avatar.onload = () => {
                avatar.classList.remove('opacity-0');
                document.getElementById('loader').style.display = 'none';
            }
        }

        function copyRef() {
            const link = document.getElementById('ref-link-text').innerText;
            navigator.clipboard.writeText(link);
            tg.HapticFeedback.notificationOccurred('success');
            tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
        }

        function shareRef() {
            const link = document.getElementById('ref-link-text').innerText;
            const shareUrl = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=–ó–∞–ø—É—Å–∫–∞–π —Å–≤–æ–∏ –∫–æ–Ω–∫—É—Ä—Å—ã –≤ Major!`;
            tg.openTelegramLink(shareUrl);
        }

        function setAmount(val) {
            document.getElementById('ton-amount').value = val;
            tg.HapticFeedback.impactOccurred('light');
        }

        tonConnectUI.onStatusChange(wallet => {
            const donateBlock = document.getElementById('donation-block');
            if (wallet) {
                donateBlock.classList.remove('opacity-30', 'pointer-events-none');
            } else {
                donateBlock.classList.add('opacity-30', 'pointer-events-none');
            }
        });

        async function sendDonation() {
            const amountInput = document.getElementById('ton-amount').value;
            const amountInNano = parseFloat(amountInput) * 1000000000;
            if (isNaN(amountInNano) || amountInput < 0.1) {
                tg.showAlert("–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ 0.1 TON");
                return;
            }
            const transaction = {
                validUntil: Math.floor(Date.now() / 1000) + 600,
                messages: [{ address: MY_WALLET_ADDRESS, amount: amountInNano.toString() }]
            };
            try {
                const statusEl = document.getElementById('status-msg');
                statusEl.innerText = "Confirm in wallet...";
                statusEl.className = "text-yellow-500 text-[10px] font-bold uppercase text-center";
                await tonConnectUI.sendTransaction(transaction);
                statusEl.innerText = "‚úÖ Success! Thank you.";
                statusEl.className = "text-green-500 text-[10px] font-bold uppercase text-center";
                tg.HapticFeedback.notificationOccurred('success');
            } catch (e) {
                document.getElementById('status-msg').innerText = "‚ùå Cancelled";
                document.getElementById('status-msg').className = "text-red-500 text-[10px] font-bold uppercase text-center";
                tg.HapticFeedback.notificationOccurred('error');
            }
        }
        tg.expand();
    </script>
</body>
</html>